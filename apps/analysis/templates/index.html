{% extends 'analysis_base.html'%}
{% load static %}
<style>
    .card {
            transition: transform 0.2s ease;
            box-shadow: 0 4px 6px 0 rgba(22, 22, 26, 0.18);
            border-radius: 0;
            /* border: 0; */
            /* margin-bottom: 1.5em; */
        }

        .card:hover {
            transform: scale(1.1);
        }
    </style>
{% block content%}

<body>
    <div class="main-wrapper">

        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-brand">
                    Smart<span>Traffic</span>
                </a>
                <div class="sidebar-toggler not-active">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="sidebar-body">
                <ul class="nav">
                    <li class="nav-item active">
                        <a href="{% url 'index' %}" class="nav-link">
                            <i class="link-icon" data-feather="box"></i>
                            <span class="link-title">All sites</span>
                        </a>
                    </li>
                    {% for site in site_name%}
                    <li class="nav-item">
                        <a href="{% url 'dashboard' site_name=site %}" class="nav-link">
                            <i class="link-icon" data-feather="framer"></i>
                            <span class="link-title">{{site}}</span>
                        </a>
                    </li>
                    {% endfor %}

                </ul>
            </div>
        </nav>

        <div class="page-wrapper">
            <!-- partial:partials/_navbar.html -->
            <nav class="navbar">
                <a href="#" class="sidebar-toggler">
                    <i data-feather="menu"></i>
                </a>
                <div class="navbar-content">
                    <!-- <form class="search-form">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <div class="input-group-text">
                                    <i data-feather="search"></i>
                                </div>
                            </div>
                            <input type="text" class="form-control" id="navbarForm" placeholder="Search here...">
                        </div>
                    </form> -->
                    <ul class="navbar-nav">

                        <li class="nav-item dropdown nav-profile">
                            <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img src="{% static 'images\my.jpg'%}" alt="profile">
                            </a>
                            <div class="dropdown-menu" aria-labelledby="profileDropdown">
                                <div class="dropdown-header d-flex flex-column align-items-center">
                                    <div class="figure mb-3">
                                        <img src="{% static 'images\my.jpg'%}" alt="">
                                    </div>
                                    <div class="info text-center">
                                        <p class="name font-weight-bold mb-0">Ehtisham </p>
                                        <p class="email text-muted mb-3">shamikhan0347</p>
                                    </div>
                                </div>
                                <div class="dropdown-body">
                                    <ul class="profile-nav p-0 pt-3">
                                        <li class="nav-item">
                                            <a href="profile.html" class="nav-link">
                                                <i data-feather="user"></i>
                                                <span>Profile</span>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="javascript:;" class="nav-link">
                                                <i data-feather="edit"></i>
                                                <span>Edit Profile</span>
                                            </a>
                                        </li>
                                        <!-- <li class="nav-item">
                                            <a href="javascript:;" class="nav-link">
                                                <i data-feather="repeat"></i>
                                                <span>Switch User</span>
                                            </a>
                                        </li> -->
                                        <li class="nav-item">
                                            <a href="javascript:;" class="nav-link">
                                                <i data-feather="log-out"></i>
                                                <span>Log Out</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- partial -->
            <div class="page-content">

                <div class="d-flex justify-content-between align-items-center flex-wrap grid-margin">
                    <div>
                        <h4 class="mb-3 mb-md-0">Welcome to Traffic Monitoring System</h4>
                    </div>
                    <!-- <div class="d-flex align-items-center flex-wrap text-nowrap">
                        
                        <button type="button" class="btn btn-primary btn-icon-text mb-2 mb-md-0">
                            <i class="btn-icon-prepend" data-feather="download-cloud"></i>
                            Download Report
                        </button>
                    </div> -->
                </div>


                <div class="row">
                    <!-- Location -->
                    {% for site in site_name%}

                    <div class="col-lg-5 col-xl-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body p-0">
                                <h4 class="p-3 text-center">{{site}}</h4>
                                <a href="{% url 'dashboard' site_name=site %}">
                                    <!-- video -->
                                    <div>
                                        <img src="{% static 'images/map.PNG'%}" alt="stream2"
                                            style="height: 400px; width: 100%;" id="{{site}}">

                                    </div>
                                </a>
                            </div>

                            <div class="card-footer">
                                <div class="row m-2">
                                    <div class="col-5 d-flex justify-content-end">
                                        <div>
                                            <label
                                                class="d-flex align-items-center justify-content-end tx-24 text-uppercase font-weight-bold">yesterday
                                                Total Traffic
                                                <span class="p-1 ml-1 rounded-circle bg-primary-muted"></span></label>
                                            <h5 class="font-weight-bold p-1 ml-5 " style="font-size: large;"
                                                id="yesterday_count">500</h5>
                                        </div>
                                    </div>
                                    <div class="col-2 d-flex justify-content-end vr">


                                    </div>
                                    <div class="col-5">
                                        <div>
                                            <label
                                                class="d-flex align-items-center tx-32 text-uppercase font-weight-bold"><span
                                                    class="p-1 mr-1 rounded-circle bg-primary"></span>Today Total
                                                Traffic</label>
                                            <!-- </label> -->
                                            <!-- add right margin -->
                                            <h5 class="font-weight-bold p-1 ml-5 " style="font-size: large;"
                                                id="today_count">100</h5>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <!-- Location -->

                    <!-- map  -->
                    <!-- <div class="col-2 d-flex "></div> -->

                    <div class="col-12 ">
                        <!-- add google map image into div -->
                        <!-- <div>
                            <img src="{% static 'images/map.PNG'%}" alt="map" width="100%" height="50%">
                        </div> -->


                    </div>
                    <!-- <div class="col-1 d-flex "></div> -->
                </div> <!-- row -->
                <!-- <div id="map"></div> -->

            </div>

        </div>

    </div>

    {% include 'analysis_script.html' %}

    <script>
        const socket = io.connect('http://127.0.0.1:7000');
        socket.on('connect', function () {
            console.log('connected');
        });

        socket.on('disconnect', function () {
            console.log('disconnected');
        });

        {% for site in site_name %}
        socket.on('{{site}}', function (data) {
            document.getElementById('{{site}}').src = "data:image/png;base64," + data;
        });
        {% endfor %}



    </script>
</body>
{% endblock %}