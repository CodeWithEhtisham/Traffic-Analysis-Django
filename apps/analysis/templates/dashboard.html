{% extends 'analysis_base.html'%}
{% load static %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
	<!-- <script async src="https://docs.opencv.org/master/opencv.js" type="text/javascript"></script> -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>
<body>
    <div class="main-wrapper">
        {% include 'sidebar.html'%}
        <div class="page-wrapper">
            <!-- partial:partials/_navbar.html -->
            {% include 'navbar.html'%}
            <!-- partial -->
            <div class="page-content">

                <div class="d-flex justify-content-between align-items-center flex-wrap grid-margin">
                    <div>
                        <h4 class="mb-3 mb-md-0">Dashboard</h4>
                    </div>
                    <div class="d-flex align-items-center flex-wrap text-nowrap">

                        <a type="button" class="btn btn-outline-info btn-icon-text mr-2 d-none d-md-block"
                            href="{% url 'history' %}">
                            <i class="btn-icon-prepend" data-feather="activity"></i>
                            History
                        </a>
                        <a type="button" class="btn btn-outline-primary btn-icon-text mr-2 mb-2 mb-md-0"
                            href="{% url 'video_analysis' %}">
                            <i class="btn-icon-prepend" data-feather="video"></i>
                            Video Analysis
                        </a>
                        <a type="button" class="btn btn-primary btn-icon-text mb-2 mb-md-0"
                            href="{% url 'index' %}">
                            <i class="btn-icon-prepend" data-feather="bar-chart"></i>
                            Live Stream Analysis
                        </a>
                    </div>
                </div>

                <div class="row">
                    <!-- area chart -->
                    <!-- <div class="col-xl-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Streaming Analysis</h6>
                                
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Vehicle</th>
                                                    <th>Count</th>
                                                    <th>status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="today_table">
                                                <tr>
                                                    <td class="py-1">
                                                        Car
                                                    </td>
                                                    <td>44</td>
                                                    <td>
                                                        <div class="progress">
                                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                                                                role="progressbar" style="width: 25%" aria-valuenow="25"
                                                                aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="py-1">
                                                        Bike
                                                    </td>
                                                    <td>22</td>
                                                    <td>
                                                        <div class="progress">
                                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger"
                                                                role="progressbar" style="width: 22%" aria-valuenow="75"
                                                                aria-valuemin="0" aria-valuemax="100"></div>
                                                        </div>
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                    </div> -->
                    <div class="col-xl-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Bar chart <span id="bar-chart-title"></span></h6>
                                <div id="e_bar_chart" style="width: 100%; height: 400px "></div>
                            </div>
                        </div>
                    </div>
                    <!-- end area chart -->
                    <!-- bar chart -->
                    <div class="col-xl-6 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Streaming {{site_name}}</h6>
                                <div>
                                    <!-- <video id="video" width="100%" height="100%" controls autoplay>
                                        
                                        <source
                                            src="https://codingyaar.com/wp-content/uploads/video-in-bootstrap-card.mp4"
                                            type="video/mp4" width="100%" height="100%">
                                    </video> -->
                                    <img src alt="stream2" style="height: 400px; width: 100%;" id="{{site_name}}">

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- bar chart End -->

                </div>
                <!-- first row end -->

                <!-- second row start -->
                <div class="row">

                    <!-- plot chart with dynamic font-size -->
                    <div class="col-xl-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">MultiLine <span id="multiline-chart-title"></span></h6>
                                <div id="e_multiline_chart" style="width: 100%; height: 800px;"></div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <!-- area chart -->
                    <div class="col-xl-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Area chart <span id="area-chart-title"></span><h5></h5>
                                </h6>
                                <div id="e_line_chart" style="width: 100%; height: 400px;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- end area chart -->
                    <!-- bar chart -->

                    <!-- bar chart End -->

                </div>
                <!-- first row end -->

                <!-- <div class="row">
                    <div class="col-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">Bar chart</h6>
                                <div id="echartbar" style="height: 400px;"></div>
                            </div>
                        </div>
                    </div>

                </div> -->

            </div>

        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
    <!-- <script src="{% static 'js/dynamic-plots.js'%}"></script> -->
    <script src="{% static 'js/charts/e_bar_chart.js'%}"></script>
    <script src="{% static 'js/charts/e_multiline_chart.js'%}"></script>
    <script src="{% static 'js/charts/e_line_chart.js'%}"></script>
    <!-- <script src="{% static 'js/dynamic-plots.js'%}"></script> -->
    <script>
        // var socket = io.connect("http://
        const socket = io.connect('http://127.0.0.1:7000');
        socket.on("connect", function () {
            console.log("connected");
        });

        socket.on("disconnect", function () {
            console.log("disconnected");
        });

        socket.on("{{site_name}}", function (data) {
            document.getElementById('{{site_name}}').src = "data:image/png;base64," + data;
        });


        var csrfToken = "{{ csrf_token }}";
        var site_name = "{{site_name}}";
        // // ajax apis for getting data

        setInterval(function () {
            // Get the current date and time
            const currentDate = new Date();

            // Set the time to midnight (00:00:00 AM)
            const startDate = new Date(currentDate);
            startDate.setHours(0, 0, 0, 0);

            // Format the start date and time
            const formattedDateFrom = startDate.toLocaleString('en-US', {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true,
            });

            // Print the formatted start date and time
            // console.log(`date: ${formattedDateFrom}`);

            // Format the current date and time
            const formattedDateTo = currentDate.toLocaleString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true,
            });
            let date=`      (${formattedDateFrom} To ${formattedDateTo})`
            // Print the formatted current date and time
            // console.log(`date: ${formattedDateTo}`);

            // $.ajax({
            //     method: "POST",
            //     url: "/apis/get_table_records",
            //     dataType: "json",
            //     headers: { "X-CSRFToken": csrfToken },
            //     data: {
            //         "site_name": site_name,
            //     },
            //     success: function (data) {
            //         // console.log(data);
            //         let percentage = data['percentage'];
            //         let today_data = data['data'];

            //         // Update the table rows
            //         let tableData = '';
            //         Object.entries(today_data).forEach(([vehicle, count], index) => {
            //             tableData += `
            //     <tr>
            //         <td>${vehicle}</td>
            //         <td>${count}</td>
            //         <td>
            //             <div class="progress">
            //                 <div class="progress-bar progress-bar-striped progress-bar-animated ${percentage[index] > 50 ? 'bg-success' : 'bg-danger'}" role="progressbar" style="width: ${percentage[index]}%" aria-valuenow="${percentage[index]}" aria-valuemin="0" aria-valuemax="100"></div>
            //             </div>
            //         </td>
            //     </tr>
            // `;
            //         });

            //         // Update the table with the new data
            //         $('#today_table').html(tableData);
            //     },
            //     error: function () {
            //         console.log("Error on get_vehicle_counts");
            //     }
            // });

            multi_line_chart_fun(csrfToken, site_name);
            line_chart_fun(csrfToken, site_name);
            bar_chart_fun(csrfToken, site_name);
            document.getElementById('bar-chart-title').innerHTML=date
            document.getElementById('multiline-chart-title').innerHTML=date
            document.getElementById('area-chart-title').innerHTML=date
            
        }, 10000); // 30 seconds in milliseconds





    </script>
    <!-- <script src="static/js/morris.js'%}"></script> -->
    <!-- <script>
        


    </script> -->

</body>
{% endblock %}